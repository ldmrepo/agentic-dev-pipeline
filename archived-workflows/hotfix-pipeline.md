# 핫픽스 파이프라인

## 🚨 긴급 수정 워크플로우

이 워크플로우는 프로덕션 환경의 Critical 이슈를 신속하게 해결하기 위한 긴급 수정 프로세스입니다.

**목표 완료 시간: 60분 이내**

## 실행 방법
```bash
export ISSUE_DESCRIPTION="프로덕션에서 사용자 로그인이 안 되는 문제"
export ISSUE_PRIORITY="critical"
claude -f workflows/hotfix-pipeline.md
```

## 워크플로우 단계

### 🔍 1단계: 긴급 분석 (10분)

다음을 즉시 수행해줘:

#### 영향도 분석
- 이슈 설명: ${ISSUE_DESCRIPTION}
- 우선순위: ${ISSUE_PRIORITY}
- 영향받는 사용자 수 추정
- 비즈니스 임팩트 평가 (매출, 사용자 경험)
- 시스템 전체에 미치는 영향 범위 파악

#### 근본 원인 분석
```
로그 분석:
- 최근 1시간 에러 로그 검토
- 배포 히스토리 확인 (최근 24시간)
- 인프라 변경 사항 검토
- 외부 의존성 상태 확인

시스템 상태 점검:
- 데이터베이스 연결 상태
- 캐시 서버 상태  
- 외부 API 응답 상태
- 네트워크 연결 상태
```

#### 수정 범위 결정
- 최소 변경으로 문제 해결 가능한 지점 식별
- 사이드 이펙트가 없는 안전한 수정 방법 선택
- 롤백 계획 수립

**결과물**: `hotfix-analysis-${timestamp}.md` 파일 생성

---

### ⚡ 2단계: 긴급 수정 구현 (20분)

다음 원칙에 따라 최소한의 수정을 구현해줘:

#### 수정 구현 원칙
- **최소 변경**: 문제의 직접적 원인만 수정
- **검증된 방법**: 이전에 사용한 안전한 패턴 활용
- **롤백 가능**: 언제든 이전 상태로 복구 가능
- **로깅 강화**: 수정 효과를 모니터링할 수 있도록 로그 추가

#### 구현 작업
```
코드 수정:
1. 문제가 되는 코드 부분 정확히 식별
2. 최소한의 라인 수정으로 문제 해결
3. 추가 예외 처리 및 에러 핸들링 강화
4. 중요 포인트에 로깅 추가

설정 수정 (필요시):
1. 환경 변수 조정
2. 데이터베이스 연결 설정 검토
3. 캐시 설정 최적화
4. 타임아웃 값 조정
```

#### 타겟 테스트 작성
```
핫픽스 검증 테스트:
1. 문제 상황을 재현하는 테스트 케이스
2. 수정 후 정상 동작을 확인하는 테스트
3. 주요 기능에 대한 회귀 테스트
4. 성능 영향도 측정 테스트

테스트 실행:
- 로컬 환경에서 즉시 검증
- 수정 전/후 동작 비교
- 메모리 사용량, 응답시간 측정
```

**완료 조건**: 
- [ ] 문제 해결 확인
- [ ] 사이드 이펙트 없음 확인  
- [ ] 테스트 통과
- [ ] 성능 영향 최소화

---

### 🧪 3단계: 긴급 검증 (15분)

다음 검증을 신속하게 수행해줘:

#### 핵심 기능 검증
```
자동 테스트 실행:
- npm test -- --testPathPattern=hotfix
- 수정된 부분과 직접 관련된 테스트만 실행
- Critical path 테스트 (주요 사용자 플로우)

수동 검증:
1. 문제 상황 재현 후 해결 확인
2. 주요 사용자 시나리오 3-5개 테스트
3. 관련 API 엔드포인트 응답 확인
4. UI/UX 정상 동작 확인
```

#### 성능 영향 측정
```
성능 테스트:
- 응답시간 측정 (목표: 기존 대비 10% 이내)
- 메모리 사용량 확인
- CPU 사용률 모니터링
- 동시 사용자 처리 능력 확인

부하 테스트 (간단):
- k6로 5분간 기본 부하 테스트
- 에러율 0% 유지 확인
- 응답시간 안정성 확인
```

#### 보안 검증
```
기본 보안 검사:
- 수정된 코드에 보안 취약점 없는지 확인
- 인증/권한 로직 정상 동작 확인
- 민감한 데이터 노출 여부 점검
- SQL Injection, XSS 등 기본 취약점 검사
```

**통과 기준**:
- [ ] 원래 문제 해결됨
- [ ] 모든 핵심 테스트 통과
- [ ] 성능 저하 없음 (10% 이내)
- [ ] 보안 이슈 없음

---

### 🚀 4단계: 긴급 배포 (15분)

다음 긴급 배포 프로세스를 실행해줘:

#### Staging 환경 긴급 배포
```
배포 준비:
1. 핫픽스 브랜치 생성: hotfix/${issue-id}-${timestamp}
2. 변경사항 커밋: "hotfix: ${ISSUE_DESCRIPTION}"
3. 핫픽스 브랜치에 푸시

Staging 배포:
1. 자동 빌드 트리거
2. Staging 환경에 즉시 배포
3. Smoke 테스트 자동 실행 (3분)
4. 핵심 기능 동작 확인
```

#### Production 긴급 배포
```
사전 체크:
- Staging 환경 검증 완료 확인
- 롤백 계획 최종 점검
- 모니터링 대시보드 준비
- 알림 채널 활성화

Rolling Deployment:
1. 트래픽의 25%만 새 버전으로 라우팅
2. 5분간 모니터링 (에러율, 응답시간)
3. 정상이면 50% → 100% 순차 증가
4. 각 단계마다 2분씩 모니터링

자동 롤백 조건:
- 에러율 > 1%
- 평균 응답시간 > 500ms
- Critical 에러 발생
- 헬스체크 실패율 > 5%
```

#### 실시간 모니터링 강화
```
모니터링 설정:
1. 알림 임계값을 평상시의 50%로 낮춤
2. 1분 간격으로 메트릭 수집
3. 실시간 대시보드에서 지속 모니터링
4. 30분간 집중 모니터링 유지

추적 메트릭:
- API 응답시간
- 에러율 및 에러 패턴
- 사용자 활동 지표
- 비즈니스 메트릭 (로그인 성공률 등)
- 인프라 리소스 사용률
```

---

### 📊 5단계: 사후 검증 및 보고 (추가 30분)

배포 완료 후 다음을 수행해줘:

#### 효과 검증
```
비즈니스 메트릭 확인:
- 문제 해결 효과 측정
- 사용자 불만 감소 확인
- 핵심 비즈니스 지표 정상화 확인

기술적 검증:
- 30분간 연속 모니터링
- 에러 로그 패턴 분석
- 성능 지표 안정성 확인
- 다른 시스템에 미친 영향 점검
```

#### 핫픽스 보고서 생성
```
보고서 포함 내용:
1. 문제 요약 및 영향도
2. 근본 원인 분석 결과
3. 적용된 수정 사항
4. 테스트 및 검증 결과
5. 배포 과정 및 결과
6. 향후 예방 방안

파일 생성: hotfix-report-${timestamp}.md
```

#### 팀 커뮤니케이션
```
알림 발송:
1. Slack 채널에 완료 알림
2. 이메일로 상세 보고서 발송
3. 다음 정기 회의 안건에 추가
4. 문서 저장소에 사례 기록

후속 조치 계획:
- 근본적 해결 방안 검토 일정
- 유사 문제 예방을 위한 개선 계획
- 프로세스 개선 포인트 식별
```

## ⚠️ 중요 알림

### 자동 롤백 조건
다음 상황에서 즉시 자동 롤백:
- 에러율 1% 초과
- 평균 응답시간 500ms 초과  
- Critical 에러 발생
- 데이터베이스 연결 실패
- 외부 서비스 연동 장애

### 에스컬레이션 조건
다음 상황에서 인간 개입 요청:
- 60분 내 해결 불가
- 다른 시스템에 영향 확산
- 데이터 무결성 위험
- 보안 이슈 발견
- 고객 데이터 영향 가능성

### 품질 게이트
각 단계별 필수 통과 조건:
- 1단계: 근본 원인 식별 완료
- 2단계: 로컬 테스트 100% 통과
- 3단계: 성능 저하 10% 이내
- 4단계: Staging 검증 통과
- 5단계: 30분간 안정 운영 확인

**모든 단계가 성공적으로 완료되면 핫픽스 완료 보고서를 생성하고 관련 팀에 공유해줘.**

**예상 총 소요시간: 60분 (모니터링 포함 90분)**
